<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Departamento de Alumnado - Bolet√≠n Digital</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/alumnado.css">
</head>

<body class="alumnado">

  <header class="header">
    <div class="logo">
      <img src="imagenes/logoEsc.png" alt="Logo Colegio" class="logo-img">
      <div class="logo-text">
        <h1>Bolet√≠n Digital</h1>
        <p>Colegio Dr. Ernesto Guevara</p>
      </div>
    </div>

    <nav class="nav">
      <a href="index.html">Inicio</a>
      <a href="ingresar.html">Cerrar sesi√≥n</a>
    </nav>
  </header>

  <main class="alumnado-main">
    <div class="alumnado-container">
      <h2>üìö Departamento de Alumnado</h2>
      <p>Gestion√° las notas y materias de los estudiantes.</p>

      <!-- Formulario de carga -->
      <form id="formNotas" class="form-notas">
        <input type="text" id="nombre" placeholder="Nombre del estudiante" required>
        <input type="text" id="materia" placeholder="Materia" required>
        <input type="number" id="trimestre1" placeholder="1¬∞ Trim." min="1" max="10" required>
        <input type="number" id="trimestre2" placeholder="2¬∞ Trim." min="1" max="10" required>
        <input type="number" id="trimestre3" placeholder="3¬∞ Trim." min="1" max="10" required>
        <button type="submit" class="btn-accion">Agregar Nota</button>
      </form>

      <!-- Tabla de notas -->
      <table id="tablaNotas" class="tabla-notas">
        <thead>
          <tr>
            <th>Estudiante</th>
            <th>Materia</th>
            <th>1¬∞ Trim.</th>
            <th>2¬∞ Trim.</th>
            <th>3¬∞ Trim.</th>
            <th>Promedio</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="7">Cargando datos...</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <footer class="footer">
    <p>¬© 2025 Colegio Dr. Ernesto Guevara | Desarrollado por <span>Sogitec - Kiara Otero</span></p>
  </footer>

  <script>
    const form = document.getElementById('formNotas');
    const tablaBody = document.querySelector('#tablaNotas tbody');

    // Cargar notas al iniciar
    async function cargarNotas() {
      try {
        const res = await fetch('http://localhost:3000/api/notas');
        const notas = await res.json();
        tablaBody.innerHTML = '';

        if (notas.length === 0) {
          tablaBody.innerHTML = "<tr><td colspan='7'>No hay notas registradas.</td></tr>";
          return;
        }

        notas.forEach(nota => {
          const promedio = ((nota.trimestre1 + nota.trimestre2 + nota.trimestre3) / 3).toFixed(1);
          const fila = `
            <tr>
              <td>${nota.nombre}</td>
              <td>${nota.materia}</td>
              <td>${nota.trimestre1}</td>
              <td>${nota.trimestre2}</td>
              <td>${nota.trimestre3}</td>
              <td>${promedio}</td>
              <td>
                <button class="btn-editar" onclick="editarNota(${nota.id})">‚úèÔ∏è</button>
                <button class="btn-eliminar" onclick="eliminarNota(${nota.id})">üóëÔ∏è</button>
              </td>
            </tr>
          `;
          tablaBody.innerHTML += fila;
        });

      } catch (err) {
        console.error(err);
        tablaBody.innerHTML = "<tr><td colspan='7'>Error al cargar las notas.</td></tr>";
      }
    }

    // Agregar nueva nota
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const nuevaNota = {
        nombre: form.nombre.value,
        materia: form.materia.value,
        trimestre1: form.trimestre1.value,
        trimestre2: form.trimestre2.value,
        trimestre3: form.trimestre3.value
      };

      try {
        const res = await fetch('http://localhost:3000/api/notas', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(nuevaNota)
        });

        const data = await res.json();
        alert(data.mensaje);
        form.reset();
        cargarNotas();
      } catch (err) {
        alert("‚ùå Error al conectar con el servidor");
      }
    });

    // Eliminar nota
    async function eliminarNota(id) {
      if (!confirm("¬øSeguro que quer√©s eliminar esta nota?")) return;
      try {
        const res = await fetch(`http://localhost:3000/api/notas/${id}`, { method: 'DELETE' });
        const data = await res.json();
        alert(data.mensaje);
        cargarNotas();
      } catch (err) {
        alert("‚ùå Error al eliminar nota");
      }
    }

    // Editar nota (placeholder, se completa al crear notas.js backend)
    function editarNota(id) {
      alert("üìù Funci√≥n de edici√≥n pr√≥ximamente implementada.");
    }

    cargarNotas();
  </script>
</body>
</html>
